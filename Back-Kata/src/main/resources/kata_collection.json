{
  "info": {
    "_postman_id": "d8e9f0a1-2b3c-4d5e-6f7g-8h9i0j1k2l3m",
    "name": "Kata Cloud Challenge v2 (Auto-Flow)",
    "description": "ColecciÃ³n profesional con scripts de auto-guardado de Tokens y IDs.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "1. Registrar Usuario",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin_pro\",\n  \"password\": \"securePass123\",\n  \"role\": \"ADMIN\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/api/auth/register",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "register"
              ]
            }
          },
          "response": []
        },
        {
          "name": "2. Login (Guarda Token)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.token) {",
                  "    pm.environment.set(\"jwt_token\", jsonData.token);",
                  "    console.log(\"ðŸ”‘ Token actualizado correctamente\");",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin_pro\",\n  \"password\": \"securePass123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/api/auth/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "login"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Requests",
      "item": [
        {
          "name": "3. Crear Solicitud (Guarda ID)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.id) {",
                  "    pm.environment.set(\"current_request_id\", jsonData.id);",
                  "    console.log(\"ðŸ“„ ID de solicitud guardado: \" + jsonData.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{jwt_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Acceso a Servidores de ProducciÃ³n\",\n  \"description\": \"Requerido para despliegue de emergencia v2.0\",\n  \"requesterName\": \"Juan Desarrollador\",\n  \"approverName\": \"Maria Gerente\",\n  \"type\": \"ACCESO\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/api/requests",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "requests"
              ]
            }
          },
          "response": []
        },
        {
          "name": "4. Listar Todas",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{jwt_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/requests",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "requests"
              ]
            }
          },
          "response": []
        },
        {
          "name": "5. Aprobar Solicitud (Usa ID Auto)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{jwt_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "PATCH",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"APPROVED\",\n  \"comments\": \"Aprobado tras revisiÃ³n de seguridad.\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/api/requests/{{current_request_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "requests",
                "{{current_request_id}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "6. Ver Historial (Usa ID Auto)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{jwt_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/requests/{{current_request_id}}/history",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "requests",
                "{{current_request_id}}",
                "history"
              ]
            }
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080"
    },
    {
      "key": "jwt_token",
      "value": ""
    },
    {
      "key": "current_request_id",
      "value": ""
    }
  ]
}